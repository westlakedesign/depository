(function(){"use strict";window.depository=function(element,options){var elem,spec,func,util,queue,uploading;elem={};spec={};func={};util={};queue=[];uploading=false;spec.url=document.URL;spec.method="POST";spec.fieldName="image";spec.multi=true;spec.accept=["image/jpeg","image/png","image/gif"];spec.dataType="Text";spec.csrfParam=undefined;spec.csrfToken=undefined;spec.onBodyEnter=function(){return undefined};spec.onBodyLeave=function(){return undefined};spec.onEnter=function(){return undefined};spec.onLeave=function(){return undefined};spec.onStart=function(){return undefined};spec.onProgress=function(){return undefined};spec.onSuccess=function(){return undefined};spec.onAbort=function(){return undefined};spec.onError=function(){return undefined};spec.afterUpload=function(){return undefined};if(document.getElementsByName("csrf-param").length&&document.getElementsByName("csrf-token").length){spec.csrfParam=document.getElementsByName("csrf-param")[0].content;spec.csrfToken=document.getElementsByName("csrf-token")[0].content}func.init=function(element,options){var dataOpts;if(!util.isHTML5()){return}elem.body=document.getElementsByTagName("body")[0];elem.dropzone=func.processElement(element);dataOpts=func.getDataOptions(elem.dropzone);func.processOptions(dataOpts);func.processOptions(options);func.addHandlers()};func.processElement=function(element){var el;if(element.length===undefined){el=element}else{el=element[0]}return el};func.getDataOptions=function(element){var data;data={};[].forEach.call(element.attributes,function(attr){var name,value;if(/^data-dnd-/.test(attr.name)){name=util.camelCase(attr.name.replace(/^data-dnd-/,""));value=attr.value;if(/^on/.test(name)){if(typeof window[value]==="function"){data[name]=window[value]}}else{data[name]=value}}});return data};func.processOptions=function(options){var allowedOptions;if(options===undefined){return}allowedOptions=Object.keys(spec);Object.keys(options).forEach(function(key){if(allowedOptions.indexOf(key)!==-1){spec[key]=options[key]}})};func.addHandlers=function(){var overTimeout;elem.dropzone.addEventListener("dragenter",function(e){util.stop(e);spec.onEnter(e)});elem.dropzone.addEventListener("dragleave",function(e){util.stop(e);spec.onLeave(e)});elem.dropzone.addEventListener("drop",function(e){util.stop(e);spec.onLeave(e);spec.onBodyLeave(e);clearTimeout(overTimeout);overTimeout=undefined;func.handleFileDrop(e)});elem.dropzone.addEventListener("dragover",function(e){e.dataTransfer.dropEffect="copy"});document.addEventListener("dragover",function(e){util.stop(e);if(overTimeout===undefined){spec.onBodyEnter(e)}clearTimeout(overTimeout);overTimeout=setTimeout(function(){spec.onBodyLeave(e);overTimeout=undefined},100)});document.addEventListener("drop",util.stop)};func.handleFileDrop=function(e){func.processFiles(e.dataTransfer.files);if(!uploading&&queue.length>0){func.startUpload()}};func.processFiles=function(files){var i;if(spec.multi===false){func.addToQueue(files[0])}else{for(i=0;i<files.length;i+=1){func.addToQueue(files[i])}}};func.addToQueue=function(file){if(spec.accept.indexOf(file.type)===-1){return}queue.push(file)};func.startUpload=function(){uploading=true;spec.onStart();func.uploadAFile()};func.uploadAFile=function(){var file,fd,xhr;file=queue.shift();fd=new FormData;fd.append(spec.fieldName,file);if(typeof spec.csrfParam==="string"&&typeof spec.csrfToken==="string"){fd.append(spec.csrfParam,spec.csrfToken)}xhr=new XMLHttpRequest;xhr.upload.addEventListener("progress",spec.onProgress,false);xhr.addEventListener("abort",spec.onAbort,false);xhr.addEventListener("error",function(){var res;res=xhr.responseText;if(spec.dataType==="JSON"){try{res=JSON.parse(res)}catch(e){res=""}}spec.onError(res,0)});xhr.addEventListener("load",function(){var res,code;code=xhr.status;res=xhr.responseText;if(spec.dataType==="JSON"){try{res=JSON.parse(res)}catch(e){res=""}}if(/2\d{2}/.test(code.toString())){spec.onSuccess(res,code)}else{spec.onError(res,code)}func.next()},false);xhr.open(spec.method,spec.url);xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");if(spec.dataType==="JSON"){xhr.setRequestHeader("Accept","application/json")}xhr.send(fd)};func.next=function(){if(queue.length===0){uploading=false;spec.afterUpload();return}func.uploadAFile()};util.isHTML5=function(){return(typeof FormData==="function"||typeof FormData==="object")&&(typeof XMLHttpRequest==="function"||typeof XMLHttpRequest==="object")};util.stop=function(e){e.preventDefault();e.stopPropagation()};util.camelCase=function(word){word=word.replace(/-([\w\W])/g,function(w1,w2){return w2.toUpperCase()});return word};func.init(element,options);return spec}})();