(function(){"use strict";window.depository=function(e,n){var t,o,r,i,f,a,u,d,c;t={};o={};r={};i={};f={};a=[];u=[];d=false;c=0;o.url=document.URL;o.method="POST";o.fieldName="image";o.multi=true;o.accept=["image/jpeg","image/png","image/gif"];o.dataType="Text";o.csrfParam=undefined;o.csrfToken=undefined;o.onBodyEnter=function(){return undefined};o.onBodyLeave=function(){return undefined};o.onEnter=function(){return undefined};o.onLeave=function(){return undefined};o.onStart=function(){return undefined};o.onEnqueue=function(){return undefined};o.onProgress=function(){return undefined};o.onSuccess=function(){return undefined};o.onAbort=function(){return undefined};o.onError=function(){return undefined};o.afterUpload=function(){return undefined};if(document.getElementsByName("csrf-param").length&&document.getElementsByName("csrf-token").length){o.csrfParam=document.getElementsByName("csrf-param")[0].content;o.csrfToken=document.getElementsByName("csrf-token")[0].content}r.init=function(e,n){var o;if(!f.isHTML5()){return}t.body=document.getElementsByTagName("body")[0];t.dropzone=r.processElement(e);if(t.dropzone===undefined){console.log(e);console.warn("invalid element passed to depository");return}o=r.getDataOptions(t.dropzone);r.processOptions(o);r.processOptions(n);r.addHandlers()};r.processElement=function(e){var n;if(e.length===undefined){n=e}else{n=e[0]}return n};r.getDataOptions=function(e){var n;n={};[].forEach.call(e.attributes,function(e){var t,o;if(/^data-dnd-/.test(e.name)){t=f.camelCase(e.name.replace(/^data-dnd-/,""));o=e.value;if(/^on/.test(t)){if(typeof window[o]==="function"){n[t]=window[o]}}else{n[t]=o}}});return n};r.processOptions=function(e){var n;if(e===undefined){return}n=Object.keys(o);Object.keys(e).forEach(function(t){if(n.indexOf(t)!==-1){o[t]=e[t]}})};r.addHandlers=function(){var e;t.dropzone.addEventListener("dragenter",function(e){f.stop(e);o.onEnter(e)});t.dropzone.addEventListener("dragleave",function(e){f.stop(e);o.onLeave(e)});t.dropzone.addEventListener("drop",function(n){f.stop(n);o.onLeave(n);o.onBodyLeave(n);clearTimeout(e);e=undefined;r.handleFileDrop(n)});t.dropzone.addEventListener("dragover",function(e){e.dataTransfer.dropEffect="copy"});document.addEventListener("dragover",function(n){f.stop(n);if(e===undefined){o.onBodyEnter(n)}clearTimeout(e);e=setTimeout(function(){o.onBodyLeave(n);e=undefined},100)});document.addEventListener("drop",f.stop)};r.handleFileDrop=function(e){r.processFiles(e.dataTransfer.files)};r.processFiles=function(e){var n;if(o.multi===false){r.addToQueue(e[0])}else{for(n=0;n<e.length;n+=1){r.addToQueue(e[n])}}};r.addToQueue=function(e){if(o.accept.indexOf(e.type)===-1){return}c+=1;e.id=c;o.onEnqueue(e);a.push(e);r.startUpload()};r.startUpload=function(){if(d||a.length===0){return}d=true;o.onStart(a);r.uploadAFile()};r.uploadAFile=function(){var e,n,t;e=a.shift();n=new FormData;n.append(o.fieldName,e);if(typeof o.csrfParam==="string"&&typeof o.csrfToken==="string"){n.append(o.csrfParam,o.csrfToken)}t=new XMLHttpRequest;t.upload.addEventListener("progress",function(n){o.onProgress(n,e)},false);t.addEventListener("abort",function(n){o.onAbort(n,e)},false);t.addEventListener("error",function(){var n;n=t.responseText;if(o.dataType==="JSON"){try{n=JSON.parse(n)}catch(r){n=""}}o.onError(n,0,e)});t.addEventListener("load",function(){var n,i;i=t.status;n=t.responseText;if(o.dataType==="JSON"){try{n=JSON.parse(n)}catch(f){n=""}}if(/2\d{2}/.test(i.toString())){o.onSuccess(n,i,e)}else{o.onError(n,i,e)}r.next()},false);t.addEventListener("loadend",function(){u.splice(t,1)},false);u.push(t);t.open(o.method,o.url);t.setRequestHeader("X-Requested-With","XMLHttpRequest");if(o.dataType==="JSON"){t.setRequestHeader("Accept","application/json")}t.send(n)};r.next=function(){if(a.length===0){d=false;o.afterUpload();return}r.uploadAFile()};r.abort=function(){a=[];u.forEach(function(e){e.abort();u.splice(e,1)})};i.addToQueue=r.addToQueue;i.abort=r.abort;i.url=function(e){if(typeof e==="string"){o.url=e}};i.method=function(e){if(typeof e==="string"){o.method=e}};i.fieldName=function(e){if(typeof e==="string"){i.fieldName=e}};i.multi=function(e){if(typeof e==="boolean"||typeof e==="number"){o.multi=e}};i.accept=function(e){if(typeof e==="object"&&e.length!==undefined){o.accept=e}};i.dataType=function(e){if(typeof e==="string"){o.dataType=e}};i.csrfParam=function(e){if(typeof e==="string"){o.csrfParam=e}};i.csrfToken=function(e){if(typeof e==="string"){o.csrfToken=e}};i.onBodyEnter=function(e){if(typeof e==="function"){o.onBodyEnter=e}};i.onBodyLeave=function(e){if(typeof e==="function"){o.onBodyLeave=e}};i.onEnter=function(e){if(typeof e==="function"){o.onEnter=e}};i.onLeave=function(e){if(typeof e==="function"){o.onLeave=e}};i.onStart=function(e){if(typeof e==="function"){o.onStart=e}};i.onEnqueue=function(e){if(typeof e==="function"){o.onEnqueue=e}};i.onProgress=function(e){if(typeof e==="function"){o.onProgress=e}};i.onSuccess=function(e){if(typeof e==="function"){o.onSuccess=e}};i.onAbort=function(e){if(typeof e==="function"){o.onAbort=e}};i.onError=function(e){if(typeof e==="function"){o.onError=e}};i.afterUpload=function(e){if(typeof e==="function"){o.afterUpload=e}};f.isHTML5=function(){return(typeof FormData==="function"||typeof FormData==="object")&&(typeof XMLHttpRequest==="function"||typeof XMLHttpRequest==="object")};f.stop=function(e){e.preventDefault();e.stopPropagation()};f.camelCase=function(e){e=e.replace(/-([\w\W])/g,function(e,n){return n.toUpperCase()});return e};r.init(e,n);return i}})();